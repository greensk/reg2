# Вывод списка записей из базы данных

Для создания страницы требуется создать новый контроллер или добавить действие (action) в существующий (см. [создание статичной страницы](static.md)).

Для вывода страницы требуется знать id записи, вывод которой предполагается. Как правило id записи будет являеться частью URL страницы. Для этого нужно создать действие с параметром, который будет соответствовать id записи.
```php
public function actionIndex() {
}
```

Затем, как и для вывода единичной записи, требуется подключить соответсвующую модель в текущее пространство имен. Например, если мы хотим вывести запись о конференции, при этом модель конференции находится в файле `common/models`, необходимо добавить в класс контроллера следующую директиву:
```php
use \common\models\Conference;
```

Для получения массива и объектов, соответствующих всем записям таблицы `Conference`, используется следующее:

```php
$list = Conference::find()->all();
```

В этом случае в переменную `$list` будет помещен массив, содержащий все записи из таблицы `Conference` (каждая запись будет представлять собой объект класса `Conference`). Если таблица пустая, будет возвращен пустой массив. См. также [спецификацию](http://www.yiiframework.com/doc-2.0/yii-db-activequery.html#all()-detail) метода `all`.

## Сортировка

Как правило, при выводе записей необходимо отсортировать их в определенном порядке. Для этого используется метод `orderBy`, который вызывается в цепочке перед вызовом `all`:

```php
$list = Conference::find()->orderBy(['created' => SORT_DESC])->all();
```

В качестве аргументов методу `orderBy` передается массив полей, по которому необходимо выпонить сортировку. При этом индексом является название поля, по которому нужно отсортировать, а значением константа `SORT_ASC` для сортировки по-возрастанию, `SORT_DESC` для сортировки по-убыванию. Можно указать несколько полей, в этом случае будет выполнена сортировка по первому полю, в случае, если значения первого поля у двух записей равны, выполняется сортировка по второму полю и т.д. См. также [спецификацию](http://www.yiiframework.com/doc-2.0/yii-db-querytrait.html#orderBy()-detail) метода `orderBy`.

## Фильтрация

Во многих случаях требуется вывести не все записи, а только те, которые отвечают определенному условию. Для этого существует ряд методов, соответствующих возможностям SQL для построения запросов типа `SELECT`. В простейшем случае используется метод `having`, который вызывается в цепочке перед вызовом `all`:

```php
$list = Conference::find()->having(array('enabled' => 1))->all();
```

Т.о. в качестве аргумента передается массив, в котором индексом является название поле, значением ожидаемое значение поля. Другим вариантов является передача в качестве аргумента строки, соответствующей фрагменту SQL-запроса, идущего после `HAVING`:

```php
$list = Conference::find()->having('enabled = 1')->all();
```
В обоих случаях в массив будут возвращены только те записи, в которых поле `enabled` имеет значение `1`, что в соответствии с логикой приложения соответствует тому, что конференция не была отключена администратором. См. также [подробное описание возможных значений аргумента](http://www.yiiframework.com/doc-2.0/yii-db-query.html#where()-detail).


## Пример
Таким образом, в простейшем случае контроллер может выглядеть следующим образом:
```php
<?php
/**
 * @file frontned/controllers/SimpleController.php
 * 
 */
namespace frontend\controllers;

use Yii;
use yii\web\Controller;
use \common\models\Conference;

/**
 * Site controller
 */
class SimpleController extends Controller
{
    public function actionIndex()
    {
        $list = Conference::find()->having('enabled = 1')->orderBy(['created' => SORT_DESC])->all();
        return $this->render('index', ['list' => $list]);
    }
}
```

Простейший случай представления выглядит так:
```php
<ul>
  <?php foreach ($list as $conference) { ?>
  <li><?= htmlspecialchars($conference->title) ?></li>
  <?php } ?>
</ul>
```

## Упражнения

1. Добавьте для приложения примера вывод списка неактивных мероприятий, начиная с самых старых.
2. Для своего приложения выбреите одну сущность и, перед началом реализаци, ответье на вопросы:
 * Какой порядок вывода записей будет наиболее логичный?
 * Все ли записи нужно выводить? Есть ли в вашей базе данных статус активности для этой сущности?
 * В каком виде имеет смысл выводить записи? Будет ли это список или таблица?
3. Реализуйте для своего приложения страницу, выводяющую список сущностей.
